#!/bin/bash
# é¡¹ç›®æ‰“åŒ…è„šæœ¬ - ä¸ºéƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨å‡†å¤‡æ–‡ä»¶

set -e

echo "ðŸ—‚ï¸ å¼€å§‹æ‰“åŒ…é¡¹ç›®æ–‡ä»¶..."

# åˆ›å»ºéƒ¨ç½²åŒ…ç›®å½•
DEPLOY_DIR="competition_deploy_$(date +%Y%m%d_%H%M%S)"
mkdir -p $DEPLOY_DIR

echo "ðŸ“¦ å¤åˆ¶å¿…è¦æ–‡ä»¶åˆ° $DEPLOY_DIR"

# å¤åˆ¶æ ¸å¿ƒæ–‡ä»¶
cp package.json $DEPLOY_DIR/
cp server_new.js $DEPLOY_DIR/
cp -r config $DEPLOY_DIR/
cp -r middleware $DEPLOY_DIR/
cp -r routes $DEPLOY_DIR/
cp -r services $DEPLOY_DIR/
cp -r utils $DEPLOY_DIR/
cp -r public $DEPLOY_DIR/

# å¤åˆ¶éƒ¨ç½²é…ç½®
cp -r deploy $DEPLOY_DIR/

# åˆ›å»ºç”Ÿäº§çŽ¯å¢ƒé…ç½®ï¼ˆä½¿ç”¨æ›´æ–°åŽçš„ç‰ˆæœ¬ï¼‰
cp deploy/production_updated.env $DEPLOY_DIR/.env

# åˆ›å»ºREADMEæ–‡ä»¶
cat > $DEPLOY_DIR/DEPLOY_README.md << 'EOF'
# å…¬å¹³ç«žäº‰å®¡æŸ¥ç³»ç»Ÿéƒ¨ç½²åŒ…

## ðŸš€ éƒ¨ç½²æ­¥éª¤

### 1. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
```bash
# å°†æ•´ä¸ªæ–‡ä»¶å¤¹ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -r competition_deploy_* root@your-server:/tmp/
```

### 2. åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œéƒ¨ç½²è„šæœ¬
```bash
# SSHè¿žæŽ¥åˆ°æœåŠ¡å™¨
ssh root@your-server

# è¿›å…¥ä¸Šä¼ ç›®å½•
cd /tmp/competition_deploy_*

# ç»™éƒ¨ç½²è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy/deploy.sh

# è¿è¡Œéƒ¨ç½²è„šæœ¬
./deploy/deploy.sh
```

### 3. éªŒè¯éƒ¨ç½²
è®¿é—® http://cursor2.com ç¡®è®¤ç³»ç»Ÿæ­£å¸¸è¿è¡Œ

## ðŸ”§ é‡è¦ä¿®å¤

âœ… **å·²ä¿®å¤AIè¶…æ—¶é—®é¢˜**
- å®žçŽ°æ™ºèƒ½å›žé€€æœºåˆ¶ï¼ˆReasoner â†’ Chatæ¨¡åž‹ï¼‰
- ä¼˜åŒ–è¶…æ—¶é…ç½®
- æé«˜ç³»ç»Ÿç¨³å®šæ€§

## ðŸŽ¯ ç³»ç»Ÿç‰¹æ€§

- âœ… æ–‡ä»¶ä¸Šä¼ å®¡æŸ¥ï¼ˆæ”¯æŒ.docx, .doc, .txtï¼‰
- âœ… AIæ™ºèƒ½åˆ†æžï¼ˆDeepSeek APIï¼‰
- âœ… æµå¼å®žæ—¶å“åº”ï¼ˆSSEï¼‰
- âœ… ä¸“ä¸šå®¡æŸ¥æŠ¥å‘Šç”Ÿæˆ
- âœ… å®¡æŸ¥è®°å½•ç®¡ç†
- âœ… æ™ºèƒ½å›žé€€æœºåˆ¶

## ðŸ“‹ APIæŽ¥å£

- `/` - ä¸»é¡µé¢
- `/stream-review` - æµå¼å®¡æŸ¥æŽ¥å£
- `/export-report` - å¯¼å‡ºæŠ¥å‘ŠæŽ¥å£
- `/admin/audit-logs` - å®¡æŸ¥è®°å½•ç®¡ç†
- `/test-api` - APIæµ‹è¯•é¡µé¢

## âš™ï¸ é…ç½®è¯´æ˜Ž

ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨æ™ºèƒ½å›žé€€æœºåˆ¶ï¼š
1. ä¼˜å…ˆå°è¯•DeepSeek-Reasoneræ¨¡åž‹ï¼ˆ45ç§’è¶…æ—¶ï¼‰
2. è¶…æ—¶åŽè‡ªåŠ¨åˆ‡æ¢åˆ°DeepSeek-Chatæ¨¡åž‹ï¼ˆå¿«é€Ÿç¨³å®šï¼‰
3. ä¿è¯å®¡æŸ¥åŠŸèƒ½å§‹ç»ˆå¯ç”¨

EOF

# åˆ›å»ºéƒ¨ç½²æ£€æŸ¥æ¸…å•
cat > $DEPLOY_DIR/DEPLOY_CHECKLIST.md << 'EOF'
# éƒ¨ç½²æ£€æŸ¥æ¸…å• âœ…

## éƒ¨ç½²å‰æ£€æŸ¥
- [ ] ç¡®è®¤APIå¯†é’¥æœ‰æ•ˆ
- [ ] ç¡®è®¤åŸŸåè§£æžæ­£ç¡®
- [ ] ç¡®è®¤æœåŠ¡å™¨å¯è®¿é—®äº’è”ç½‘
- [ ] å¤‡ä»½çŽ°æœ‰æ•°æ®ï¼ˆå¦‚æœ‰ï¼‰

## éƒ¨ç½²è¿‡ç¨‹æ£€æŸ¥  
- [ ] æ–‡ä»¶ä¸Šä¼ æˆåŠŸ
- [ ] éƒ¨ç½²è„šæœ¬è¿è¡Œæ— é”™è¯¯
- [ ] Node.js æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] Nginx é…ç½®ç”Ÿæ•ˆ
- [ ] PM2 è¿›ç¨‹ç®¡ç†é…ç½®æ­£ç¡®

## éƒ¨ç½²åŽéªŒè¯
- [ ] è®¿é—® http://cursor2.com æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] AIå®¡æŸ¥åŠŸèƒ½æ­£å¸¸ï¼ˆæµ‹è¯•ç®€å•æ–‡æ¡£ï¼‰
- [ ] æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½æ­£å¸¸
- [ ] æµå¼å“åº”æ­£å¸¸
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸

## æ€§èƒ½æ£€æŸ¥
- [ ] å“åº”é€Ÿåº¦åˆç†ï¼ˆ<10ç§’å®Œæˆå®¡æŸ¥ï¼‰
- [ ] å†…å­˜ä½¿ç”¨æ­£å¸¸
- [ ] CPUä½¿ç”¨æ­£å¸¸
- [ ] é”™è¯¯æ—¥å¿—æ— å¼‚å¸¸

## å¸¸è§é—®é¢˜æŽ’æŸ¥

### 1. AIè°ƒç”¨è¶…æ—¶
âœ… **å·²ä¿®å¤** - ç³»ç»Ÿä¼šè‡ªåŠ¨å›žé€€åˆ°Chatæ¨¡åž‹

### 2. æ–‡ä»¶ä¸Šä¼ å¤±è´¥
- æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆé»˜è®¤50MBï¼‰
- æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ”¯æŒ
- æŸ¥çœ‹nginxé”™è¯¯æ—¥å¿—

### 3. åŸŸåæ— æ³•è®¿é—®
- æ£€æŸ¥DNSè§£æž
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- æ£€æŸ¥Nginxé…ç½®

### 4. SSLè¯ä¹¦é—®é¢˜
- ç¡®è®¤è¯ä¹¦æ–‡ä»¶å­˜åœ¨
- æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
- è¿è¡Œ `nginx -t` æµ‹è¯•é…ç½®

EOF

# æ˜¾ç¤ºéƒ¨ç½²åŒ…ä¿¡æ¯
echo ""
echo "âœ… æ‰“åŒ…å®Œæˆï¼"
echo ""
echo "ðŸ“¦ éƒ¨ç½²åŒ…: $DEPLOY_DIR"
echo "ðŸ“„ åŒ…å«æ–‡ä»¶:"
ls -la $DEPLOY_DIR
echo ""
echo "ðŸš€ ä¸‹ä¸€æ­¥æ“ä½œ:"
echo "1. å°† $DEPLOY_DIR æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°æœåŠ¡å™¨"
echo "2. åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œ: ./deploy/deploy.sh"
echo "3. æŒ‰ç…§ DEPLOY_README.md ä¸­çš„è¯´æ˜Žè¿›è¡Œéƒ¨ç½²"
echo ""
echo "ðŸ” é‡è¦ä¿®å¤:"
echo "âœ… AIè¶…æ—¶é—®é¢˜å·²ä¿®å¤ï¼ˆæ™ºèƒ½å›žé€€æœºåˆ¶ï¼‰"
echo "âœ… é…ç½®æ–‡ä»¶å·²ä¼˜åŒ–"
echo "âœ… éƒ¨ç½²è„šæœ¬å·²å®Œå–„"