/**
 * 增强的公平竞争审查提示词模板
 * 包含完整的《公平竞争审查条例实施办法》内容
 * 按用户要求简化违法条款描述格式
 */

const COMPLETE_LEGAL_FRAMEWORK = `
《公平竞争审查条例实施办法》核心条款：

=== 第一节 关于限制市场准入和退出的审查标准 ===

第九条：不得含有对市场准入负面清单以外的行业、领域、业务等违法设置市场准入审批程序的内容，包括：
(一)在全国统一的市场准入负面清单之外违规制定市场准入性质的负面清单；
(二)违规设立准入许可，或者以备案、证明、目录、计划、规划、认证等方式，要求经营主体经申请获批后方可从事投资经营活动；
(三)违法增加市场准入审批环节和程序，或者设置具有行政审批性质的前置备案程序。

第十条：不得含有违法设置或者授予政府特许经营权的内容，包括：
(一)没有法律、行政法规依据或者未经国务院批准，设置特许经营权或者以特许经营名义增设行政许可事项；
(二)未通过招标、谈判等公平竞争方式选择政府特许经营者；
(三)违法约定或者未经法定程序变更特许经营期限。

第十一条：不得含有限定经营、购买或者使用特定经营者提供的商品或者服务的内容，包括：
(一)以明确要求、暗示等方式，限定或者变相限定经营、购买、使用特定经营者提供的商品；
(二)通过限定经营者所有制形式、注册地、组织形式，或者设定其他不合理条件，限定或者变相限定经营、购买、使用特定经营者提供的商品；
(三)通过设置不合理的项目库、名录库、备选库、资格库等方式，限定或者变相限定经营、购买、使用特定经营者提供的商品。

第十二条：不得含有设置不合理或者歧视性的准入、退出条件的内容，包括：
(一)设置明显不必要或者超出实际需要的准入条件；
(二)根据经营者所有制形式、注册地、组织形式、规模等设置歧视性的市场准入、退出条件；
(三)在经营者注销、破产、挂牌转让等方面违法设置市场退出障碍。

=== 第二节 关于限制商品、要素自由流动的审查标准 ===

第十三条：不得含有限制外地或者进口商品、要素进入本地市场，或者阻碍本地经营者迁出，商品、要素输出的内容，包括：
(一)对外地或者进口商品规定与本地同类商品不同的技术要求、检验标准，更多的检验频次等歧视性措施，或者要求重复检验、重复认证；
(二)通过设置关卡或者其他手段，阻碍外地和进口商品、要素进入本地市场或者本地商品、要素对外输出；
(三)违法设置审批程序或者其他不合理条件妨碍经营者变更注册地址、减少注册资本，或者对经营者在本地经营年限提出要求。

第十四条：不得含有排斥、限制、强制或者变相强制外地经营者在本地投资经营或者设立分支机构的内容，包括：
(一)强制、拒绝或者阻碍外地经营者在本地投资经营或者设立分支机构；
(二)对外地经营者在本地投资的规模、方式、产值、税收，以及设立分支机构的商业模式、组织形式等进行不合理限制或者提出不合理要求；
(三)将在本地投资或者设立分支机构作为参与本地政府采购、招标投标、开展生产经营的必要条件。

第十五条：不得含有排斥、限制或者变相限制外地经营者参加本地政府采购、招标投标的内容，包括：
(一)禁止外地经营者参与本地政府采购、招标投标活动；
(二)直接或者变相要求优先采购在本地登记注册的经营者提供的商品；
(三)将经营者取得业绩和奖项荣誉的区域、缴纳税收社保的区域、投标产品的产地、注册地址、与本地经营者组成联合体等作为投标条件、加分条件、中标条件或者评标条款。

第十六条：不得含有对外地或者进口商品、要素设置歧视性收费项目、收费标准、价格或者补贴的内容，包括：
(一)对外地或者进口商品、要素设置歧视性的收费项目或者收费标准；
(二)对外地或者进口商品、要素实行歧视性的价格；
(三)对外地或者进口商品、要素实行歧视性的补贴政策。

第十七条：不得含有在资质标准、监管执法等方面对外地经营者在本地投资经营设置歧视性要求的内容，包括：
(一)对外地经营者在本地投资经营规定歧视性的资质、标准等要求；
(二)对外地经营者实施歧视性的监管执法标准，增加执法检查项目或者提高执法检查频次等；
(三)在投资经营规模、方式和税费水平等方面对外地经营者规定歧视性要求。

=== 第三节 关于影响生产经营成本的审查标准 ===

第十八条：没有法律、行政法规依据或者未经国务院批准，不得含有给予特定经营者税收优惠的内容，包括：
(一)减轻或者免除特定经营者的税收缴纳义务；
(二)通过违法转换经营者组织形式等方式，变相支持特定经营者少缴或者不缴税款；
(三)通过对特定产业园区实行核定征收等方式，变相支持特定经营者少缴或者不缴税款。

第十九条：没有法律、行政法规依据或者未经国务院批准，不得含有给予特定经营者选择性、差异化的财政奖励或者补贴的内容，包括：
(一)以直接确定受益经营者或者设置不明确、不合理入选条件的名录库、企业库等方式，实施财政奖励或者补贴；
(二)根据经营者的所有制形式、组织形式等实施财政奖励或者补贴；
(三)以外地经营者将注册地迁移至本地、在本地纳税、纳入本地统计等为条件，实施财政奖励或者补贴；
(四)采取列收列支或者违法违规采取先征后返、即征即退等形式，对特定经营者进行返还，或者给予特定经营者财政奖励或者补贴、减免自然资源有偿使用收入等优惠政策。

第二十条：没有法律、行政法规依据或者未经国务院批准，不得含有给予特定经营者要素获取、行政事业性收费、政府性基金、社会保险费等方面优惠的内容，包括：
(一)以直接确定受益经营者，或者设置无客观明确条件的方式在要素获取方面给予优惠政策；
(二)减免、缓征或者停征行政事业性收费、政府性基金；
(三)减免或者缓征社会保险费用。

=== 第四节 关于影响生产经营行为的审查标准 ===

第二十一条：不得含有强制或者变相强制经营者实施垄断行为，或者为经营者实施垄断行为提供便利条件的内容，包括：
(一)以行政命令、行政指导等方式，强制、组织或者引导经营者实施垄断行为；
(二)通过组织签订协议、备忘录等方式，强制或者变相强制经营者实施垄断行为；
(三)对实行市场调节价的商品、要素，违法公开披露或者要求经营者公开披露拟定价格、成本、生产销售数量、生产销售计划、经销商和终端客户信息等生产经营敏感信息。

第二十二条：不得含有超越法定权限制定政府指导价、政府定价，为特定经营者提供优惠价格，影响生产经营行为的内容，包括：
(一)对实行政府指导价的商品、要素进行政府定价，违法提供优惠价格；
(二)对不属于本级政府定价目录范围内的商品、要素制定政府指导价、政府定价，违法提供优惠价格；
(三)不执行政府指导价或者政府定价，违法提供优惠价格。

第二十三条：不得含有违法干预实行市场调节价的商品、要素价格水平的内容，包括：
(一)对实行市场调节价的商品、要素制定建议价，影响公平竞争；
(二)通过违法干预手续费、保费、折扣等方式干预实行市场调节价的商品、要素价格水平，影响公平竞争。

第二十四条：不得含有其他限制或者变相限制市场准入和退出、限制商品要素自由流动、影响生产经营成本、影响生产经营行为等影响市场公平竞争的内容。
`;

// 生成详细审查提示词
function generateDetailedReviewPrompt(text) {
    return `你是一位公平竞争审查专家。请对以下政策文件进行详细的公平竞争审查，重点关注是否存在排除、限制竞争的内容。

${COMPLETE_LEGAL_FRAMEWORK}

【🎯 审查要求】
1. 仔细比对政策内容与上述法规条款，识别潜在违规问题
2. 重点关注：市场准入限制、商品要素流动障碍、成本影响、行为干预等方面
3. 准确引用具体的法条条款
4. **重要：按问题点合并违法条款，避免重复列举相同问题**

【📋 问题合并指导】
常见需要合并的问题类型：
- "本地注册/投资要求"：通常涉及第十四条+第十二条，应合并为一个问题
- "政府采购限制"：通常涉及第十五条多个分项，应合并为一个问题  
- "财政奖励补贴"：通常涉及第十九条+第二十条，应合并为一个问题
- "商品流动限制"：通常涉及第十三条+第十六条，应合并为一个问题

【📝 违法条款描述格式要求】
按照以下简化格式描述违法条款，不需要重复法律依据：
- 直接写明违反《公平竞争审查条例实施办法》第X条：具体条款内容
- 详细说明该条款的适用情形和禁止行为
- 不需要在最后重复写"法律依据：《公平竞争审查条例实施办法》第X条"

【🎯 重要原则：同一问题点只选择最典型的条款】
- 如果同一处政策内容违反了多个审查条款，只选择最典型、最直接的1个条款列出
- 其他相关但次要的违法条款不要列出，避免重复
- 每个问题只引用一个最主要的违法条款

【✅ 正确做法示例】
对于"须在村落景区所在地注册成立运营公司，村集体必须占有股份"这一处内容：
✅ 只列出：违反《公平竞争审查条例实施办法》第十四条第（一）项：不得强制外地经营者在本地设立分支机构
✅ 不要再单独列出第十二条（歧视性准入条件）或其他相关条款

【❌ 错误做法】  
❌ 同一处"强制本地注册"内容被拆分成多个问题：
   问题1：违反第十四条（强制设立分支机构）
   问题2：违反第十五条（注册地限制）  
   问题3：违反第十二条（歧视性准入条件）
✅ 正确做法：只选择最典型的第十四条，其他条款不列出

请按以下JSON格式返回审查结果：
{
  "totalIssues": 问题总数(数字),
  "issues": [
    {
      "id": 问题编号,
      "title": "问题标题",
      "description": "问题描述",
      "quote": "原文引用",
      "violation": "按上述简化格式描述的违法条款",
      "suggestion": "修改建议（如有多条建议，请用1. 2. 3.格式分条列出）"
    }
  ],
  "rawResponse": "整体评价和建议"
}

文档内容：
${text}`;
}

// 生成流式审查提示词  
function generateStreamReviewPrompt(text) {
    return generateDetailedReviewPrompt(text); // 使用相同的提示词
}

module.exports = {
    COMPLETE_LEGAL_FRAMEWORK,
    generateDetailedReviewPrompt,
    generateStreamReviewPrompt
};