/**
 * 公平竞争审查法律框架配置 - 完整版
 * 基于《公平竞争审查条例实施办法》（国家市场监督管理总局令第99号，2025年2月28日公布）
 * 根据用户要求：直接引用具体条款内容，不重复法律依据
 */

// 核心法规条款 - 完整版（基于实施办法全文）
const COMPLETE_LEGAL_ARTICLES = {
    // 第一节 关于限制市场准入和退出的审查标准
    "article_9": {
        "number": "第九条",
        "section": "限制市场准入和退出",
        "content": "不得含有对市场准入负面清单以外的行业、领域、业务等违法设置市场准入审批程序的内容",
        "details": "包括：(一)在全国统一的市场准入负面清单之外违规制定市场准入性质的负面清单；(二)违规设立准入许可，或者以备案、证明、目录、计划、规划、认证等方式，要求经营主体经申请获批后方可从事投资经营活动；(三)违法增加市场准入审批环节和程序，或者设置具有行政审批性质的前置备案程序等"
    },
    
    "article_10": {
        "number": "第十条",
        "section": "限制市场准入和退出", 
        "content": "不得含有违法设置或者授予政府特许经营权的内容",
        "details": "包括：(一)没有法律、行政法规依据或者未经国务院批准，设置特许经营权或者以特许经营名义增设行政许可事项；(二)未通过招标、谈判等公平竞争方式选择政府特许经营者；(三)违法约定或者未经法定程序变更特许经营期限等"
    },
    
    "article_11": {
        "number": "第十一条",
        "section": "限制市场准入和退出",
        "content": "不得含有限定经营、购买或者使用特定经营者提供的商品或者服务的内容", 
        "details": "包括：(一)以明确要求、暗示等方式，限定或者变相限定经营、购买、使用特定经营者提供的商品；(二)通过限定经营者所有制形式、注册地、组织形式，或者设定其他不合理条件，限定或者变相限定经营、购买、使用特定经营者提供的商品；(三)通过设置不合理的项目库、名录库、备选库、资格库等方式，限定或者变相限定经营、购买、使用特定经营者提供的商品等"
    },
    
    "article_12": {
        "number": "第十二条", 
        "section": "限制市场准入和退出",
        "content": "不得含有设置不合理或者歧视性的准入、退出条件的内容",
        "details": "包括：(一)设置明显不必要或者超出实际需要的准入条件；(二)根据经营者所有制形式、注册地、组织形式、规模等设置歧视性的市场准入、退出条件；(三)在经营者注销、破产、挂牌转让等方面违法设置市场退出障碍等"
    },

    // 第二节 关于限制商品、要素自由流动的审查标准
    "article_13": {
        "number": "第十三条",
        "section": "限制商品、要素自由流动",
        "content": "不得含有限制外地或者进口商品、要素进入本地市场，或者阻碍本地经营者迁出，商品、要素输出的内容",
        "details": "包括：(一)对外地或者进口商品规定与本地同类商品不同的技术要求、检验标准，更多的检验频次等歧视性措施，或者要求重复检验、重复认证；(二)通过设置关卡或者其他手段，阻碍外地和进口商品、要素进入本地市场或者本地商品、要素对外输出；(三)违法设置审批程序或者其他不合理条件妨碍经营者变更注册地址、减少注册资本，或者对经营者在本地经营年限提出要求等"
    },
    
    "article_14": {
        "number": "第十四条",
        "section": "限制商品、要素自由流动", 
        "content": "不得含有排斥、限制、强制或者变相强制外地经营者在本地投资经营或者设立分支机构的内容",
        "details": "包括：(一)强制、拒绝或者阻碍外地经营者在本地投资经营或者设立分支机构；(二)对外地经营者在本地投资的规模、方式、产值、税收，以及设立分支机构的商业模式、组织形式等进行不合理限制或者提出不合理要求；(三)将在本地投资或者设立分支机构作为参与本地政府采购、招标投标、开展生产经营的必要条件等"
    },
    
    "article_15": {
        "number": "第十五条",
        "section": "限制商品、要素自由流动",
        "content": "不得含有排斥、限制或者变相限制外地经营者参加本地政府采购、招标投标的内容",
        "details": "包括：(一)禁止外地经营者参与本地政府采购、招标投标活动；(二)直接或者变相要求优先采购在本地登记注册的经营者提供的商品；(三)将经营者取得业绩和奖项荣誉的区域、缴纳税收社保的区域、投标产品的产地、注册地址、与本地经营者组成联合体等作为投标条件、加分条件、中标条件或者评标条款等"
    },
    
    "article_16": {
        "number": "第十六条",
        "section": "限制商品、要素自由流动",
        "content": "不得含有对外地或者进口商品、要素设置歧视性收费项目、收费标准、价格或者补贴的内容", 
        "details": "包括：(一)对外地或者进口商品、要素设置歧视性的收费项目或者收费标准；(二)对外地或者进口商品、要素实行歧视性的价格；(三)对外地或者进口商品、要素实行歧视性的补贴政策等"
    },
    
    "article_17": {
        "number": "第十七条",
        "section": "限制商品、要素自由流动",
        "content": "不得含有在资质标准、监管执法等方面对外地经营者在本地投资经营设置歧视性要求的内容",
        "details": "包括：(一)对外地经营者在本地投资经营规定歧视性的资质、标准等要求；(二)对外地经营者实施歧视性的监管执法标准，增加执法检查项目或者提高执法检查频次等；(三)在投资经营规模、方式和税费水平等方面对外地经营者规定歧视性要求等"
    },

    // 第三节 关于影响生产经营成本的审查标准  
    "article_18": {
        "number": "第十八条",
        "section": "影响生产经营成本",
        "content": "没有法律、行政法规依据或者未经国务院批准，不得含有给予特定经营者税收优惠的内容",
        "details": "包括：(一)减轻或者免除特定经营者的税收缴纳义务；(二)通过违法转换经营者组织形式等方式，变相支持特定经营者少缴或者不缴税款；(三)通过对特定产业园区实行核定征收等方式，变相支持特定经营者少缴或者不缴税款等"
    },
    
    "article_19": {
        "number": "第十九条",
        "section": "影响生产经营成本",
        "content": "没有法律、行政法规依据或者未经国务院批准，不得含有给予特定经营者选择性、差异化的财政奖励或者补贴的内容",
        "details": "包括：(一)以直接确定受益经营者或者设置不明确、不合理入选条件的名录库、企业库等方式，实施财政奖励或者补贴；(二)根据经营者的所有制形式、组织形式等实施财政奖励或者补贴；(三)以外地经营者将注册地迁移至本地、在本地纳税、纳入本地统计等为条件，实施财政奖励或者补贴；(四)采取列收列支或者违法违规采取先征后返、即征即退等形式，对特定经营者进行返还，或者给予特定经营者财政奖励或者补贴、减免自然资源有偿使用收入等优惠政策等"
    },
    
    "article_20": {
        "number": "第二十条",
        "section": "影响生产经营成本", 
        "content": "没有法律、行政法规依据或者未经国务院批准，不得含有给予特定经营者要素获取、行政事业性收费、政府性基金、社会保险费等方面优惠的内容",
        "details": "包括：(一)以直接确定受益经营者，或者设置无客观明确条件的方式在要素获取方面给予优惠政策；(二)减免、缓征或者停征行政事业性收费、政府性基金；(三)减免或者缓征社会保险费用等"
    },

    // 第四节 关于影响生产经营行为的审查标准
    "article_21": {
        "number": "第二十一条",
        "section": "影响生产经营行为", 
        "content": "不得含有强制或者变相强制经营者实施垄断行为，或者为经营者实施垄断行为提供便利条件的内容",
        "details": "包括：(一)以行政命令、行政指导等方式，强制、组织或者引导经营者实施垄断行为；(二)通过组织签订协议、备忘录等方式，强制或者变相强制经营者实施垄断行为；(三)对实行市场调节价的商品、要素，违法公开披露或者要求经营者公开披露拟定价格、成本、生产销售数量、生产销售计划、经销商和终端客户信息等生产经营敏感信息等"
    },
    
    "article_22": {
        "number": "第二十二条",
        "section": "影响生产经营行为",
        "content": "不得含有超越法定权限制定政府指导价、政府定价，为特定经营者提供优惠价格，影响生产经营行为的内容",
        "details": "包括：(一)对实行政府指导价的商品、要素进行政府定价，违法提供优惠价格；(二)对不属于本级政府定价目录范围内的商品、要素制定政府指导价、政府定价，违法提供优惠价格；(三)不执行政府指导价或者政府定价，违法提供优惠价格等"
    },
    
    "article_23": {
        "number": "第二十三条", 
        "section": "影响生产经营行为",
        "content": "不得含有违法干预实行市场调节价的商品、要素价格水平的内容",
        "details": "包括：(一)对实行市场调节价的商品、要素制定建议价，影响公平竞争；(二)通过违法干预手续费、保费、折扣等方式干预实行市场调节价的商品、要素价格水平，影响公平竞争等"
    },

    // 第五节 关于审查标准的其他规定
    "article_24": {
        "number": "第二十四条",
        "section": "其他限制竞争行为", 
        "content": "不得含有其他限制或者变相限制市场准入和退出、限制商品要素自由流动、影响生产经营成本、影响生产经营行为等影响市场公平竞争的内容",
        "details": "包括但不限于以上各条未明确列举但实质上限制或影响公平竞争的各种政策措施"
    },
    
    "article_25": {
        "number": "第二十五条",
        "section": "例外情形",
        "content": "经公平竞争审查具有或者可能具有排除、限制竞争效果的政策措施，符合特定情形之一，且没有对公平竞争影响更小的替代方案，并能够确定合理的实施期限或者终止条件的，可以出台",
        "details": "特定情形包括：(一)为维护国家安全和发展利益的；(二)为促进科学技术进步、增强国家自主创新能力的；(三)为实现节约能源、保护环境、救灾救助等社会公共利益的；(四)法律、行政法规规定或者经国务院批准的其他情形"
    }
};

// 生成简化的违规描述（按用户要求格式）
function generateSimplifiedViolationDescription(articleKey, specificContent = "") {
    const article = COMPLETE_LEGAL_ARTICLES[articleKey];
    if (!article) return "违反《公平竞争审查条例实施办法》相关条款";
    
    // 按用户要求：直接写明违反哪一条哪一项，以及具体的条款内容，不需要重复的法律依据部分
    return `违反《公平竞争审查条例实施办法》${article.number}：${article.content}。${article.details}${specificContent ? '\n\n具体问题：' + specificContent : ''}`;
}

// 关键词到条款的映射（用于智能匹配）
const KEYWORD_TO_ARTICLE_MAPPING = {
    // 市场准入相关
    "本地企业": ["article_11", "article_12", "article_15"],
    "当地供应商": ["article_11", "article_15"],
    "本地供应商": ["article_11", "article_15"],
    "限定": ["article_11", "article_12"],
    "指定": ["article_11"],
    "排除": ["article_11", "article_15"],
    "特许经营": ["article_10"],
    "专营": ["article_10"],
    "独家": ["article_10"],
    "垄断": ["article_21"],
    
    // 商品流动相关  
    "外地": ["article_13", "article_14", "article_15", "article_16", "article_17"],
    "进口": ["article_13", "article_16"],
    "歧视性": ["article_12", "article_13", "article_15", "article_16", "article_17"],
    "注册地": ["article_11", "article_13", "article_15"],
    "投资": ["article_14"],
    "分支机构": ["article_14"],
    "政府采购": ["article_15"],
    "招标投标": ["article_15"],
    "招标": ["article_15"],
    "投标": ["article_15"],
    
    // 成本影响相关
    "税收优惠": ["article_18"],
    "减免税": ["article_18", "article_20"],
    "财政奖励": ["article_19"],
    "补贴": ["article_19"],
    "财政补贴": ["article_19"],
    "专项资金": ["article_19"],
    "产业基金": ["article_19"],
    "引导基金": ["article_19"],
    "经济贡献": ["article_19"],
    "纳税额": ["article_19"],
    "产值": ["article_19"],
    "营收": ["article_19"],
    "税收贡献": ["article_19"],
    "贡献度": ["article_19"],
    
    // 行为干预相关
    "强制": ["article_21"],
    "政府指导价": ["article_22"],
    "政府定价": ["article_22"],
    "市场调节价": ["article_23"],
    "价格": ["article_22", "article_23"]
};

// 智能匹配相关条款
function findRelevantArticles(text) {
    const relevantArticles = new Set();
    
    Object.entries(KEYWORD_TO_ARTICLE_MAPPING).forEach(([keyword, articles]) => {
        if (text.includes(keyword)) {
            articles.forEach(article => relevantArticles.add(article));
        }
    });
    
    return Array.from(relevantArticles);
}

// 改进的建议模板
const ENHANCED_SUGGESTIONS = {
    "article_9": [
        "删除在全国统一市场准入负面清单之外的准入限制",
        "简化审批程序，减少不必要的前置条件",
        "确保准入条件公开透明，接受社会监督"
    ],
    "article_10": [
        "取消未经法定程序设置的特许经营权",
        "建立公开透明的特许经营权授予机制",
        "通过招标等公平竞争方式选择经营者"
    ],
    "article_11": [
        "删除限定特定经营者的条款",
        "建立开放的供应商准入机制", 
        "确保所有符合条件的经营者都能公平参与"
    ],
    "article_12": [
        "审查并删除歧视性的准入退出条件",
        "建立统一的市场准入标准",
        "简化市场退出程序"
    ],
    "article_13": [
        "取消对外地商品的歧视性措施",
        "统一检验检测标准，避免重复检验",
        "简化跨区域经营的审批程序"
    ],
    "article_14": [
        "删除强制外地经营者本地投资的条款",
        "取消投资经营的地域性限制",
        "保障经营者投资选址的自主权"
    ],
    "article_15": [
        "确保外地经营者公平参与政府采购和招标投标",
        "删除以注册地、产地等为条件的限制",
        "建立统一的评标标准"
    ],
    "article_16": [
        "取消对外地商品的歧视性收费",
        "建立统一的收费标准",
        "确保价格和补贴政策公平透明"
    ],
    "article_17": [
        "统一资质标准，不得设置歧视性要求",
        "建立公平的监管执法机制",
        "确保外地经营者享受同等待遇"
    ],
    "article_18": [
        "审查税收优惠政策的合法性",
        "确保税收政策符合国家统一规定",
        "避免通过税收政策扭曲竞争"
    ],
    "article_19": [
        "建立公平透明的财政奖励补贴机制",
        "删除以地域、所有制等为条件的差异化政策",
        "确保财政政策符合竞争中性原则"
    ],
    "article_20": [
        "规范要素获取优惠政策",
        "审查行政事业性收费减免的合法性",
        "确保优惠政策公平适用"
    ],
    "article_21": [
        "删除强制经营者实施垄断行为的条款",
        "避免通过行政手段干预正常竞争",
        "保护经营者的经营自主权"
    ],
    "article_22": [
        "严格按照定价权限制定政府价格",
        "避免违法提供价格优惠",
        "建立公平的价格形成机制"
    ],
    "article_23": [
        "尊重市场调节价格形成机制",
        "避免行政干预价格水平",
        "维护正常的价格竞争秩序"
    ],
    "article_24": [
        "全面审查政策措施的竞争影响",
        "删除其他限制竞争的条款",
        "确保政策符合公平竞争要求"
    ],
    "article_25": [
        "评估是否符合例外情形条件",
        "寻找对竞争影响更小的替代方案",
        "设定明确的实施期限或终止条件"
    ]
};

module.exports = {
    COMPLETE_LEGAL_ARTICLES,
    generateSimplifiedViolationDescription,
    KEYWORD_TO_ARTICLE_MAPPING,
    findRelevantArticles,
    ENHANCED_SUGGESTIONS,
    
    // 兼容性导出（保持现有代码正常工作）
    FAIR_COMPETITION_ARTICLES: COMPLETE_LEGAL_ARTICLES,
    generateViolationDescription: generateSimplifiedViolationDescription,
    SUGGESTION_TEMPLATES: ENHANCED_SUGGESTIONS
};