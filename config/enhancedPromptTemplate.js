/**
 * 🚀 强化的公平竞争审查提示词模板 v4.0
 * 基于用户要求大幅优化，嵌入完整《公平竞争审查条例实施办法》
 * 使用强制性指令，大幅提升违规检测准确率
 * 针对DeepSeek V3.1深度思考模型优化
 */

// 🎯 完整的《公平竞争审查条例实施办法》（国家市场监督管理总局2025年2月28日公布）
const COMPLETE_LEGAL_FRAMEWORK = `
🚨 ===《公平竞争审查条例实施办法》完整条文=== 🚨

【第二章 审查标准和重点 第一节 一般规定】

第八条 政策措施不得含有排除、限制竞争的内容。有下列情形之一的，应当认定为排除、限制竞争：
(一) 限制市场准入和退出；
(二) 限制商品和要素自由流动；
(三) 影响生产经营成本；
(四) 影响生产经营行为。

【第二节 具体审查标准】

第九条【市场准入审批】不得含有对市场准入负面清单以外的行业、领域、业务等违法设置市场准入审批程序的内容，包括：
(一) 在全国统一的市场准入负面清单之外违规制定市场准入性质的负面清单；
(二) 违规设立准入许可，或者以备案、证明、目录、计划、规划、认证等方式，要求经营主体经申请获批后方可从事投资经营活动；
(三) 违法增加市场准入审批环节和程序，或者设置具有行政审批性质的前置备案程序。

第十条【政府特许经营】不得含有违法设置或者授予政府特许经营权的内容，包括：
(一) 没有法律、行政法规依据或者未经国务院批准，设置特许经营权或者以特许经营名义增设行政许可事项；
(二) 未通过招标、谈判等公平竞争方式选择政府特许经营者；
(三) 违法约定或者未经法定程序变更特许经营期限。

第十一条【限定特定经营者】🔥重点条款🔥 不得含有限定经营、购买或者使用特定经营者提供的商品或者服务的内容，包括：
(一) 以明确要求、暗示等方式，限定或者变相限定经营、购买、使用特定经营者提供的商品；
(二) 通过限定经营者所有制形式、注册地、组织形式，或者设定其他不合理条件，限定或者变相限定经营、购买、使用特定经营者提供的商品；
(三) 通过设置不合理的项目库、名录库、备选库、资格库等方式，限定或者变相限定经营、购买、使用特定经营者提供的商品。

⚠️ 典型违规表述："指定供应商"、"限定品牌"、"推荐名单"、"优先选择XX企业"、"仅限XX公司"

第十二条【歧视性准入退出条件】🔥重点条款🔥 不得含有设置不合理或者歧视性的准入、退出条件的内容，包括：
(一) 设置明显不必要或者超出实际需要的准入条件；
(二) 根据经营者所有制形式、注册地、组织形式、规模等设置歧视性的市场准入、退出条件；
(三) 在经营者注销、破产、挂牌转让等方面违法设置市场退出障碍。

⚠️ 典型违规表述："本地注册"、"当地企业优先"、"外地企业需要额外条件"

第十三条【商品要素流动限制】🔥重点条款🔥 不得含有限制外地或者进口商品、要素进入本地市场，或者阻碍本地经营者迁出，商品、要素输出的内容，包括：
(一) 对外地或者进口商品规定与本地同类商品不同的技术要求、检验标准，更多的检验频次等歧视性措施，或者要求重复检验、重复认证；
(二) 通过设置关卡或者其他手段，阻碍外地和进口商品、要素进入本地市场或者本地商品、要素对外输出；
(三) 违法设置审批程序或者其他不合理条件妨碍经营者变更注册地址、减少注册资本，或者对经营者在本地经营年限提出要求。

⚠️ 典型违规表述："外地商品额外检验"、"禁止外地产品"、"限制商品流通"

第十四条【强制投资设立分支机构】🔥重点条款🔥 不得含有排斥、限制、强制或者变相强制外地经营者在本地投资经营或者设立分支机构的内容，包括：
(一) 强制、拒绝或者阻碍外地经营者在本地投资经营或者设立分支机构；
(二) 对外地经营者在本地投资的规模、方式、产值、税收，以及设立分支机构的商业模式、组织形式等进行不合理限制或者提出不合理要求；
(三) 将在本地投资或者设立分支机构作为参与本地政府采购、招标投标、开展生产经营的必要条件。

⚠️ 典型违规表述："必须在本地设立公司"、"强制投资"、"要求本地注册"

第十五条【政府采购招标投标歧视】🔥重点条款🔥 不得含有排斥、限制或者变相限制外地经营者参加本地政府采购、招标投标的内容，包括：
(一) 禁止外地经营者参与本地政府采购、招标投标活动；
(二) 直接或者变相要求优先采购在本地登记注册的经营者提供的商品；
(三) 将经营者取得业绩和奖项荣誉的区域、缴纳税收社保的区域、投标产品的产地、注册地址、与本地经营者组成联合体等作为投标条件、加分条件、中标条件或者评标条款。

⚠️ 典型违规表述："本地企业优先"、"政府采购优先选择本地供应商"、"本地产品加分"

第十六条【歧视性收费价格补贴】🔥重点条款🔥 不得含有对外地或者进口商品、要素设置歧视性收费项目、收费标准、价格或者补贴的内容，包括：
(一) 对外地或者进口商品、要素设置歧视性的收费项目或者收费标准；
(二) 对外地或者进口商品、要素实行歧视性的价格；
(三) 对外地或者进口商品、要素实行歧视性的补贴政策。

⚠️ 典型违规表述："外地企业收费更高"、"本地产品补贴优惠"、"差别化收费"

第十七条【资质监管歧视】🔥重点条款🔥 不得含有在资质标准、监管执法等方面对外地经营者在本地投资经营设置歧视性要求的内容，包括：
(一) 对外地经营者在本地投资经营规定歧视性的资质、标准等要求；
(二) 对外地经营者实施歧视性的监管执法标准，增加执法检查项目或者提高执法检查频次等；
(三) 在投资经营规模、方式和税费水平等方面对外地经营者规定歧视性要求。

⚠️ 典型违规表述："外地企业需要额外资质"、"外地企业需要额外保证金"、"特殊审批程序"

第十八条【违法税收优惠】🔥重点条款🔥 没有法律、行政法规依据或者未经国务院批准，不得含有给予特定经营者税收优惠的内容，包括：
(一) 减轻或者免除特定经营者的税收缴纳义务；
(二) 通过违法转换经营者组织形式等方式，变相支持特定经营者少缴或者不缴税款；
(三) 通过对特定产业园区实行核定征收等方式，变相支持特定经营者少缴或者不缴税款。

⚠️ 典型违规表述："给予XX企业税收减免"、"特定企业免税"、"差别化税收政策"

第十九条【违法财政奖励补贴】🔥重点条款🔥 没有法律、行政法规依据或者未经国务院批准，不得含有给予特定经营者选择性、差异化的财政奖励或者补贴的内容，包括：
(一) 以直接确定受益经营者或者设置不明确、不合理入选条件的名录库、企业库等方式，实施财政奖励或者补贴；
(二) 根据经营者的所有制形式、组织形式等实施财政奖励或者补贴；
(三) 以外地经营者将注册地迁移至本地、在本地纳税、纳入本地统计等为条件，实施财政奖励或者补贴；
(四) 采取列收列支或者违法违规采取先征后返、即征即退等形式，对特定经营者进行返还，或者给予特定经营者财政奖励或者补贴、减免自然资源有偿使用收入等优惠政策。

⚠️ 典型违规表述："按纳税额给予奖励"、"根据产值补贴"、"经济贡献奖励"、"迁入奖励"

第二十条【违法要素获取优惠】🔥重点条款🔥 没有法律、行政法规依据或者未经国务院批准，不得含有给予特定经营者要素获取、行政事业性收费、政府性基金、社会保险费等方面优惠的内容，包括：
(一) 以直接确定受益经营者，或者设置无客观明确条件的方式在要素获取方面给予优惠政策；
(二) 减免、缓征或者停征行政事业性收费、政府性基金；
(三) 减免或者缓征社会保险费用。

⚠️ 典型违规表述："特定企业优先获得土地"、"减免特定费用"、"社保优惠"

第二十一条【强制垄断行为】🔥重点条款🔥 不得含有强制或者变相强制经营者实施垄断行为，或者为经营者实施垄断行为提供便利条件的内容，包括：
(一) 以行政命令、行政指导等方式，强制、组织或者引导经营者实施垄断行为；
(二) 通过组织签订协议、备忘录等方式，强制或者变相强制经营者实施垄断行为；
(三) 对实行市场调节价的商品、要素，违法公开披露或者要求经营者公开披露拟定价格、成本、生产销售数量、生产销售计划、经销商和终端客户信息等生产经营敏感信息。

⚠️ 典型违规表述："授予独家经营权"、"强制垄断"、"限制竞争协议"

第二十二条【违法定价】不得含有超越法定权限制定政府指导价、政府定价，为特定经营者提供优惠价格，影响生产经营行为的内容，包括：
(一) 对实行政府指导价的商品、要素进行政府定价，违法提供优惠价格；
(二) 对不属于本级政府定价目录范围内的商品、要素制定政府指导价、政府定价，违法提供优惠价格；
(三) 不执行政府指导价或者政府定价，违法提供优惠价格。

第二十三条【违法价格干预】不得含有违法干预实行市场调节价的商品、要素价格水平的内容，包括：
(一) 对实行市场调节价的商品、要素制定建议价，影响公平竞争；
(二) 通过违法干预手续费、保费、折扣等方式干预实行市场调节价的商品、要素价格水平，影响公平竞争。

第二十四条【其他违规内容】不得含有其他限制或者变相限制市场准入和退出、限制商品要素自由流动、影响生产经营成本、影响生产经营行为等影响市场公平竞争的内容。

🚨 === 最高风险违规关键词 === 🚨
【绝对必须识别的127个违规关键词组合】

1. 地方保护主义类(32个)：
"本地企业"、"当地供应商"、"本市注册"、"本地产品"、"本土企业"、"本省企业"、"本区域企业"、"当地法人"、"本地投资"、"本地生产"、"本地采购"、"本地化"、"就近选择"、"属地管理"、"本地优先"、"当地优先"、"优先支持本地"、"倾斜本地"、"本地企业优惠"、"本地供应商名录"、"推荐本地"、"鼓励本地"、"扶持本地"、"本地化率"、"本地合作伙伴"、"本地人员"、"本地经验"、"本地业绩"、"本地资质"、"本地担保"、"本地股份"、"本地控股"

2. 限定特定经营者类(25个)：
"指定供应商"、"限定品牌"、"特定经营者"、"指定企业"、"特定公司"、"指定厂家"、"限定厂商"、"专门供应商"、"独家供应"、"唯一供应商"、"独家经营"、"专营权"、"独占权"、"排他性"、"特许经营"、"授权经营"、"委托经营"、"指定代理"、"独家代理"、"专业代理"、"限定代理"、"指定服务商"、"特定服务商"、"推荐名单"、"企业名录"

3. 歧视性条件类(28个)：
"外地企业需要"、"外地企业额外"、"外地企业应当"、"非本地企业"、"外来企业"、"异地企业"、"外省企业"、"外市企业"、"额外条件"、"额外要求"、"额外材料"、"额外程序"、"额外审批"、"额外资质"、"额外保证金"、"额外担保"、"额外费用"、"差别对待"、"区别对待"、"歧视性标准"、"歧视性条件"、"歧视性要求"、"特殊审批"、"特殊程序"、"特殊条件"、"双重审核"、"重复认证"、"重复检验"

4. 经济贡献导向类(22个)：
"按纳税额"、"根据产值"、"经济贡献"、"贡献度"、"税收贡献"、"财政贡献"、"经济效益"、"产值规模"、"营收规模"、"销售额"、"利税总额"、"上缴税费"、"创税能力"、"纳税大户"、"重点纳税企业"、"优质纳税企业"、"纳税信誉"、"税收排名"、"经济排名"、"效益排名"、"贡献排名"、"实力排名"

5. 强制限制类(20个)：
"必须选择"、"只能选择"、"仅限"、"专门"、"强制使用"、"强制采购"、"强制购买"、"禁止选择"、"不得选择"、"排除使用"、"限制使用"、"限制采购"、"限制购买"、"不允许"、"不准"、"严禁"、"杜绝"、"取消资格"、"拒绝"、"阻止"

🚨 === 隐性违规识别的18种常见模式 === 🚨

1. "鼓励就近选择供应商" → 变相地方保护
2. "推荐使用本地化率高的产品" → 变相限定本地
3. "同等条件下优先考虑" → 变相歧视
4. "建立长期合作关系" + "当地合作伙伴" → 排斥外地
5. "根据企业贡献给予倾斜" → 以经济贡献为依据
6. "重点企业名单" → 限定特定经营者
7. "绿色通道" + "重点企业" → 差别待遇
8. "额外信用担保" → 歧视性条件
9. "属地管理优势" → 变相地方保护
10. "纳入重点扶持" + "贡献度" → 违规补贴
11. "在同等质量下给予加分" + "本地" → 政府采购歧视
12. "聘用当地人员" → 变相地域限制
13. "本地经营年限要求" → 准入歧视
14. "与本地企业组成联合体" → 强制合作
15. "本地投资门槛" → 投资歧视
16. "快速审批服务" + "重点企业" → 差别待遇
17. "推荐参与重大项目" + "本土企业" → 变相限定
18. "发挥属地优势" → 地方保护主义
`;

// 生成强制性详细审查提示词
function generateDetailedReviewPrompt(text) {
    return `🚨 ===【CRITICAL MANDATORY INSTRUCTION - NO EXCEPTIONS】=== 🚨

你是公平竞争审查权威专家。你必须按照以下要求执行，不允许任何例外：

⚠️  CRITICAL INSTRUCTION - MANDATORY COMPLIANCE ⚠️
1. 对每个政策条款进行24条法规的逐条比对
2. 发现任何疑似违规必须标记为问题
3. 本地优先、地域限制、额外条件等表述必须识别为违规
4. 置信度低于90%的判断必须重新分析
5. 不允许输出"未发现问题"除非真正100%确认合规
6. 必须使用DeepSeek深度推理思考链进行分析

🔍 【STEP-BY-STEP ANALYSIS REQUIRED】

Step 1: 强制违规关键词扫描
→ 检查127个违规关键词是否出现
→ 检查18种隐性违规模式是否存在
→ 任何匹配都必须标记为问题

Step 2: 24条法规逐条对照
→ 第9-24条每条都必须检查
→ 每发现违规必须准确引用条款
→ 多条违规取最典型的一条

Step 3: 深度语义理解
→ 分析隐含的地方保护意图
→ 识别变相限制表述
→ 挖掘隐性歧视条件

Step 4: 交叉验证确认
→ 多角度验证违规判断
→ 确保未漏检任何问题
→ 最终置信度必须≥90%

${COMPLETE_LEGAL_FRAMEWORK}

【📋 强制检测的违规模式】

🚨 高度敏感的违规表述 - 发现即为违规：
• "政府采购优先选择本地供应商" → 必须标记违反第15条
• "根据企业年度纳税额给予奖励" → 必须标记违反第19条  
• "外地企业需要额外保证金" → 必须标记违反第17条
• "指定使用XX品牌" → 必须标记违反第11条
• "授予独家经营权" → 必须标记违反第21条
• "本地企业优先" → 必须标记违反第15条或第12条
• "推荐使用本地化率高的产品" → 必须标记违反第13条

🔍 隐性违规检测规则：
• "鼓励" + "本地" = 变相地方保护 → 违规
• "推荐" + "本地化" = 变相限定 → 违规  
• "优先" + "当地" = 歧视条件 → 违规
• "重点" + "名单" = 限定经营者 → 违规
• "贡献" + "奖励" = 经济导向 → 违规

⚡ 【OUTPUT FORMAT - MANDATORY】

你必须按照以下JSON格式输出，不得有任何偏差：

{
  "totalIssues": 实际发现的问题数量(必须≥1，除非真正无违规),
  "issues": [
    {
      "id": 问题编号,
      "title": "简洁的问题标题",
      "description": "详细问题描述，说明违规性质",
      "quote": "准确的原文引用(必须逐字准确)",
      "violation": "违反《公平竞争审查条例实施办法》第X条：具体条款内容和适用情形",
      "suggestion": "具体可操作的修改建议"
    }
  ],
  "rawResponse": "整体评价：发现X个违规问题，需要修改以符合公平竞争要求"
}

🎯 【ANALYSIS TARGET】政策文档内容：
${text}

🚨 REMEMBER: 你的任务是发现问题，不是为政策辩护。任何可疑表述都必须深入分析并标记。`;
}

// 生成流式审查提示词  
function generateStreamReviewPrompt(text) {
    return generateDetailedReviewPrompt(text); // 使用相同的强化提示词
}

module.exports = {
    COMPLETE_LEGAL_FRAMEWORK,
    generateDetailedReviewPrompt,
    generateStreamReviewPrompt
};